<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ company }} - Infinity {{ version }}</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Arial:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <header class="main-header">
        <nav class="navbar">
            <div class="nav-brand">
                <h1>DUNDER MIFFLIN <span class="infinity">‚àû</span></h1>
                <p class="tagline">Limitless Paper in a Paperless World‚Ñ¢</p>
            </div>
            <div class="nav-links">
                <a href="#home" class="nav-link active">HOME</a>
                <a href="#products" class="nav-link">PRODUCTS</a>
                <a href="#services" class="nav-link">SERVICES</a>
                <a href="#about" class="nav-link">ABOUT</a>
                <a href="#contact" class="nav-link">CONTACT</a>
                <a href="#careers" class="nav-link">CAREERS</a>
            </div>
            <div class="version-badge">
                <span class="version-text">INFINITY {{ version }}</span>
                <div class="new-badge">NEW!</div>
            </div>
        </nav>
    </header>

    <main class="main-content">
        <div class="hero-section">
            <div class="hero-content">
                <h2>Welcome to Infinity {{ version }}</h2>
                <p class="hero-subtitle">The Most Revolutionary Paper Experience Ever Created</p>
                <div class="upgrade-notice">
                    <strong>üéâ MAJOR UPGRADE:</strong> Infinity {{ version }} fixes all known issues from v1.0 
                    and introduces groundbreaking features you never knew you needed!
                </div>
            </div>
        </div>

        <div class="content-grid">
            <section class="main-section">
                <div class="section-header">
                    <h3>LATEST NEWS & UPDATES</h3>
                    <span class="powered-by">Powered by Infinity {{ version }} News Engine</span>
                </div>
                
                {% for item in news %}
                <article class="news-item">
                    <h4 class="news-title">{{ item.title }}</h4>
                    <div class="news-meta">
                        <span class="news-author">By {{ item.author }}</span>
                        <span class="news-date">{{ item.date }}</span>
                    </div>
                    <p class="news-content">{{ item.content }}</p>
                    <div class="news-tags">
                        <span class="tag">Breaking</span>
                        <span class="tag">Company Update</span>
                    </div>
                </article>
                {% endfor %}

                <div class="feature-spotlight">
                    <h3>üöÄ Infinity {{ version }} Features</h3>
                    <div class="features-grid">
                        <div class="feature-card">
                            <div class="feature-icon">üì±</div>
                            <h4>Mobile-First Design</h4>
                            <p>Fully responsive interface that works on BlackBerry, iPhone, and even flip phones!</p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">ü§ñ</div>
                            <h4>AI Paper Recommendations</h4>
                            <p>Our advanced AI suggests the perfect paper for every occasion using machine learning.</p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">‚õìÔ∏è</div>
                            <h4>Blockchain Supply Chain</h4>
                            <p>Track your paper from tree to desk with our revolutionary blockchain technology.</p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">‚òÅÔ∏è</div>
                            <h4>Cloud Integration</h4>
                            <p>Access your paper orders from anywhere in the cloud (actual clouds not supported).</p>
                        </div>
                    </div>
                </div>
            </section>

            <aside class="sidebar">
                {% if chat_enabled %}
                <div class="chat-widget">
                    <h3>üí¨ CHAT WITH SALES</h3>
                    <div class="chat-container" id="chatContainer">
                        <div class="chat-header">
                            <span>Choose Your Office Location</span>
                        </div>
                        <div class="office-selector" id="officeSelector">
                            <label for="office-select" class="sr-only">Select Office Location</label>
                            <select id="office-select" class="office-select" aria-label="Select office location">
                                <option value="">Select an office...</option>
                                {% for office in offices %}
                                <option value="{{ office.id }}">{{ office.name }} - {{ office.location }}</option>
                                {% endfor %}
                            </select>
                            <button id="start-chat" class="chat-button" disabled aria-label="Start chat with selected office">
                                üöÄ Start Chat
                            </button>
                        </div>
                        <div class="chat-status" id="chatStatus" style="display: none;">
                            <div class="status-indicator"></div>
                            <span class="status-text"></span>
                        </div>
                        <div class="chat-messages" id="chatMessages" style="display: none;">
                            <div class="chat-intro">
                                <p>Welcome to Dunder Mifflin chat support! You'll be connected with one of our amazing sales representatives.</p>
                            </div>
                        </div>
                        <div class="chat-input-area" id="chatInputArea" style="display: none;">
                            <label for="chat-input" class="sr-only">Type your message</label>
                            <input type="text" id="chat-input" placeholder="Type your message..." aria-label="Chat message input">
                            <button id="send-message" aria-label="Send message">Send</button>
                            <button id="end-chat" class="end-chat-btn" aria-label="End chat session">End Chat</button>
                        </div>
                    </div>
                </div>
                {% endif %}

                <div class="employee-spotlight">
                    <h3>EMPLOYEE SPOTLIGHT</h3>
                    <div class="employee-grid">
                        {% for employee in employees %}
                        <div class="employee-card">
                            <div class="employee-photo">
                                <div class="photo-placeholder">üì∑</div>
                            </div>
                            <div class="employee-info">
                                <h4>{{ employee.name }}</h4>
                                <p class="employee-title">{{ employee.title }}</p>
                                <p class="employee-dept">{{ employee.department }}</p>
                                <p class="employee-years">{{ employee.years_service }} years of service</p>
                                <blockquote class="employee-quote">"{{ employee.quote }}"</blockquote>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <div class="quick-stats">
                    <h3>INFINITY {{ version }} STATS</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-number">400%</div>
                            <div class="stat-label">More Efficient</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">73%</div>
                            <div class="stat-label">Fewer Bugs</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">‚àû</div>
                            <div class="stat-label">Possibilities</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">100%</div>
                            <div class="stat-label">Paper Based</div>
                        </div>
                    </div>
                </div>

                <div class="quick-links">
                    <h3>QUICK ACCESS</h3>
                    <ul class="link-list">
                        <li><a href="#orders">üìã Place New Order</a></li>
                        <li><a href="#inventory">üì¶ Check Inventory</a></li>
                        <li><a href="#support">üõ†Ô∏è Technical Support</a></li>
                        <li><a href="#training">üéì Infinity {{ version }} Training</a></li>
                        <li><a href="#feedback">üí¨ Send Feedback</a></li>
                        <li><a href="#bug-report">üêõ Report Bug (Unlikely)</a></li>
                    </ul>
                </div>

                <div class="testimonials">
                    <h3>WHAT PEOPLE ARE SAYING</h3>
                    <blockquote class="testimonial">
                        "Infinity {{ version }} has revolutionized how we think about paper. It's like version 1.0, 
                        but with more features and fewer problems!"
                        <cite>- Corporate, probably</cite>
                    </blockquote>
                    <blockquote class="testimonial">
                        "I don't understand what changed, but they told me it's better."
                        <cite>- Stanley Hudson</cite>
                    </blockquote>
                </div>
            </aside>
        </div>
    </main>

    <footer class="main-footer">
        <div class="footer-content">
            <div class="footer-section">
                <h4>Dunder Mifflin Paper Company</h4>
                <p>Scranton, PA ‚Ä¢ Est. 1949</p>
                <p>Infinity {{ version }} - The Future is Now</p>
            </div>
            <div class="footer-section">
                <h4>Support</h4>
                <p>24/7 Customer Service*</p>
                <p>*During business hours only</p>
                <p>Email: help@dundermifflin.com</p>
            </div>
            <div class="footer-section">
                <h4>Legal</h4>
                <p>¬© 2024 Dunder Mifflin Paper Company</p>
                <p>All rights reserved. Paper not included.</p>
            </div>
        </div>
    </footer>

    {% if chat_enabled %}
    <script>
        // Chat functionality
        let currentSessionId = null;
        let chatPollingInterval = null;

        const officeSelect = document.getElementById('office-select');
        const startChatBtn = document.getElementById('start-chat');
        const chatStatus = document.getElementById('chatStatus');
        const chatMessages = document.getElementById('chatMessages');
        const chatInputArea = document.getElementById('chatInputArea');
        const endChatBtn = document.getElementById('end-chat');

        // Enable start button when office is selected
        officeSelect.addEventListener('change', function() {
            startChatBtn.disabled = !this.value;
        });

        // Start chat
        startChatBtn.addEventListener('click', async function() {
            const officeId = officeSelect.value;
            if (!officeId) return;

            try {
                const response = await fetch('/api/chat/start', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        office_id: officeId,
                        customer_name: null
                    })
                });

                if (response.ok) {
                    const result = await response.json();
                    currentSessionId = result.session_id;
                    
                    // Show status
                    chatStatus.style.display = 'block';
                    const statusText = chatStatus.querySelector('.status-text');
                    const statusIndicator = chatStatus.querySelector('.status-indicator');
                    
                    statusText.textContent = result.message;
                    
                    if (result.status === 'connected') {
                        statusIndicator.className = 'status-indicator connected';
                        showChatInterface(result.salesperson);
                    } else if (result.status === 'waiting') {
                        statusIndicator.className = 'status-indicator waiting';
                        // Could implement polling here for queue updates
                    }
                    
                    // Hide office selector
                    document.getElementById('officeSelector').style.display = 'none';
                    
                } else {
                    alert('Failed to start chat. Please try again.');
                }
            } catch (error) {
                console.error('Error starting chat:', error);
                alert('Error starting chat. Please try again.');
            }
        });

        // Show chat interface
        function showChatInterface(salesperson) {
            chatMessages.style.display = 'block';
            chatInputArea.style.display = 'flex';
            
            if (salesperson) {
                const welcomeMsg = document.createElement('div');
                welcomeMsg.className = 'chat-message system';
                welcomeMsg.innerHTML = `
                    <strong>You're now chatting with ${salesperson.name}</strong><br>
                    <em>${salesperson.title}</em><br>
                    <small>"${salesperson.quote}"</small>
                `;
                chatMessages.appendChild(welcomeMsg);
            }
        }

        // End chat
        endChatBtn.addEventListener('click', async function() {
            if (!currentSessionId) return;

            try {
                const response = await fetch(`/api/chat/end/${currentSessionId}`, {
                    method: 'POST'
                });

                if (response.ok) {
                    resetChatInterface();
                } else {
                    alert('Failed to end chat.');
                }
            } catch (error) {
                console.error('Error ending chat:', error);
            }
        });

        // Reset chat interface
        function resetChatInterface() {
            currentSessionId = null;
            chatStatus.style.display = 'none';
            chatMessages.style.display = 'none';
            chatInputArea.style.display = 'none';
            document.getElementById('officeSelector').style.display = 'block';
            
            // Clear messages
            const systemMessages = chatMessages.querySelectorAll('.chat-message.system');
            systemMessages.forEach(msg => msg.remove());
            
            // Reset form
            officeSelect.value = '';
            startChatBtn.disabled = true;
        }

        // Send message (placeholder - would need WebSocket for real-time)
        document.getElementById('send-message').addEventListener('click', function() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            
            if (message && currentSessionId) {
                // Add message to chat (placeholder implementation)
                const msgDiv = document.createElement('div');
                msgDiv.className = 'chat-message user';
                msgDiv.textContent = message;
                chatMessages.appendChild(msgDiv);
                
                input.value = '';
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                // In a real implementation, this would send via WebSocket
                console.log('Message sent:', message);
            }
        });

        // Send message on Enter key
        document.getElementById('chat-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('send-message').click();
            }
        });
    </script>
    {% endif %}
</body>
</html>